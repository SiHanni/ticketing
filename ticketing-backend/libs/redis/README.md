# RedisService

NestJSμ—μ„ Redis κΈ°λ¥μ„ ν™μ©ν•κΈ° μ„ν• μ„λΉ„μ¤ ν΄λμ¤μ…λ‹λ‹¤.  
λ‹¤μ λ©”μ„λ“λ“¤μ„ ν¬ν•¨ν•κ³  μμΌλ©°, Redisμ key-value μ €μ¥ λ° Pub/Sub κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤.

---

## π“¦ λ©”μ„λ“ μ„¤λ…

### π© `onModuleInit(): Promise<void>`

- NestJSμ **λΌμ΄ν”„μ‚¬μ΄ν΄ ν›… μΈν„°νμ΄μ¤μΈ `OnModuleInit`**μ„ κµ¬ν„ν• λ©”μ„λ“μ…λ‹λ‹¤.
- μ΄ λ©”μ„λ“λ” NestJSκ°€ ν•΄λ‹Ή μ„λΉ„μ¤λ¥Ό **μΈμ¤ν„΄μ¤ν™”ν•κ³  μμ΅΄μ„±μ„ λ¨λ‘ μ£Όμ…ν• μ§ν›„ μλ™μΌλ΅ νΈμ¶λ©λ‹λ‹¤.**
- λ‚΄λ¶€μ—μ„ Redis ν΄λΌμ΄μ–ΈνΈλ¥Ό μƒμ„±ν•κ³  `redis://localhost:16380`μ— μ—°κ²°ν•©λ‹λ‹¤.

---

### π© `get(key: string): Promise<string | null>`

- μ£Όμ–΄μ§„ keyμ— ν•΄λ‹Ήν•λ” κ°’μ„ Redisμ—μ„ μ΅°νν•©λ‹λ‹¤
- κ°’μ΄ μ—†μΌλ©΄ `null`μ„ λ°ν™ν•©λ‹λ‹¤

---

### π© `set(key: string, value: string, ttlInSeconds?: number): Promise<void>`

- key-value λ°μ΄ν„°λ¥Ό Redisμ— μ €μ¥ν•©λ‹λ‹¤
- `ttlInSeconds`κ°€ μ£Όμ–΄μ§€λ©΄ ν•΄λ‹Ή keyμ— TTL(Time-To-Live)μ„ μ„¤μ •ν•μ—¬ μ§€μ • μ‹κ°„(μ΄) ν›„ μλ™ λ§λ£λλ„λ΅ ν•©λ‹λ‹¤

---

### π© `publish(channel: string, message: string): Promise<number>`

- Redis Pub/Sub μ‹μ¤ν…μ—μ„ μ§€μ •ν• μ±„λ„λ΅ λ©”μ‹μ§€λ¥Ό λ°ν–‰(publish)ν•©λ‹λ‹¤
- μ΄ μ±„λ„μ„ κµ¬λ… μ¤‘μΈ ν΄λΌμ΄μ–ΈνΈλ“¤μ—κ² λ©”μ‹μ§€κ°€ μ „μ†΅λ©λ‹λ‹¤
- λ°ν™κ°’μ€ λ©”μ‹μ§€λ¥Ό λ°›μ€ κµ¬λ…μ μμ…λ‹λ‹¤

---

### π© `subscribe(channel: string, callback: (message: string) => void): Promise<void>`

- Redis Pub/Sub μ‹μ¤ν…μ—μ„ μ§€μ •ν• μ±„λ„μ„ κµ¬λ…(subscribe)ν•©λ‹λ‹¤
- ν•΄λ‹Ή μ±„λ„λ΅ λ©”μ‹μ§€κ°€ λ„μ°©ν•λ©΄ μ „λ‹¬λ μ½λ°± ν•¨μκ°€ μ‹¤ν–‰λ©λ‹λ‹¤
- `this.client.duplicate()`μ„ μ‚¬μ©ν•μ—¬ **Pub/Sub μ „μ©μ λ…λ¦½λ Redis μ—°κ²°**μ„ μƒμ„±ν•μ—¬ μ‚¬μ©ν•©λ‹λ‹¤
- μ΄λ” Redisμ μ μ•½ μ‚¬ν•­(ν• ν΄λΌμ΄μ–ΈνΈκ°€ Pub/Subμ— μ§„μ…ν•λ©΄ μΌλ° λ…λ Ήμ–΄ μ‚¬μ© λ¶κ°€)μ„ νν”Όν•κΈ° μ„ν• κµ¬μ΅°μ…λ‹λ‹¤

#### π“ μ™ `duplicate()`μ΄ ν•„μ”ν•κ°€?

Redisλ” ν•λ‚μ μ—°κ²°μ—μ„ `subscribe()`λ¥Ό νΈμ¶ν•λ©΄ κ·Έ ν΄λΌμ΄μ–ΈνΈλ” **Pub/Sub μ „μ© λ¨λ“**λ΅ μ§„μ…ν•©λ‹λ‹¤.

μ΄ μƒνƒμ—μ„λ” `get`, `set`, `del` λ“±μ μΌλ° λ…λ Ήμ–΄λ¥Ό λ” μ΄μƒ μ‚¬μ©ν•  μ μ—†μµλ‹λ‹¤.

λ”°λΌμ„ **Pub/Sub μ²λ¦¬ μ „μ©μ λ³„λ„ Redis μ—°κ²°μ΄ ν•„μ”ν•λ©°**,  
μ΄λ¥Ό μ„ν•΄ `duplicate()`μΌλ΅ μƒλ΅μ΄ ν΄λΌμ΄μ–ΈνΈλ¥Ό μƒμ„±ν•©λ‹λ‹¤.

duplicate()λ” Redisμ—μ„ **Pub/Subκ³Ό μΌλ° λ…λ Ήμ–΄(get/set λ“±)**μ„ λ¶„λ¦¬λ μ—°κ²°μ—μ„ λ™μ‹μ— μ‚¬μ©ν•κΈ° μ„ν•΄ ν•„μ”ν•κΈ° λ•λ¬ΈμΈλ°, Redisλ” ν• ν΄λΌμ΄μ–ΈνΈκ°€ subscribe()λ¥Ό νΈμ¶ν•λ©΄ Pub/Sub μ „μ© λ¨λ“λ΅ λ“¤μ–΄κ°€κ³  μ΄λ• get, set, publish λ“±μ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ§€ λ»ν•λ―€λ΅ λ³„λ„μ ν΄λΌμ΄μ–ΈνΈλ¥Ό μƒμ„±ν•λ” κ²ƒμ…λ‹λ‹¤.

---

## Redis μ„¤μ • λ³€κ²½ (notify-keyspace-events)

notify-keyspace-eventsλ” Redisμ Pub/Sub κΈ°λ° Keyspace Notificationμ„ ν™μ„±ν™”ν•λ” μ„¤μ •μ…λ‹λ‹¤.

Exλ” λ‹¤μμ„ μλ―Έν•©λ‹λ‹¤:

E: Keyevent notifications (μ΄λ²¤νΈ κΈ°λ°, expired λ“±)

x: λ§λ£ μ΄λ²¤νΈ (expired)λ¥Ό κµ¬λ…

Keyspace Notificationsκ°€ λ™μ‘ν•λ ¤λ©΄ Redis μ„¤μ •μ—μ„ λ‹¤μ ν•­λ©μ΄ ν•„μ”ν•©λ‹λ‹¤

```
notify-keyspace-events Ex

```

λ΅μ»¬ redisμ—μ„λ”

```
redis-cli config set notify-keyspace-events Ex
```

λ°°ν¬ μ‹μ—λ” μƒλ΅ λ„μ»¤ μ»΄ν¬μ¦ μ‘μ„±μ„ ν•λ” κ²ƒμ΄ μΆ‹μ•„λ³΄μ…λ‹λ‹¤.

λΉλ“

pnpm run build:libs
